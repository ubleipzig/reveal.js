<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8">

    <title>Docker und VuFind(2)</title>

    <meta name="description" content="what is Docker™ and why should you use it">
    <meta name="author" content="Ulf Seltmann">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/docker.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', include the PDF print sheet -->
    <script>
        if (window.location.search.match(/print-pdf/gi)) {
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = 'css/print/pdf.css';
            document.getElementsByTagName('head')[0].appendChild(link);
        }
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<div class="reveal">
    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section>
            <div class="row">
                <img data-src="images/docker/logo-notext.png" width="500" class="frontscreen"/>
            </div>
            <div class="row">
                <p>eine Vorstellung der Container-Virtualisierung</p>
                <h2>Docker</h2>
                <p>und ihr Einsatz in der Entwicklung von VuFind(2)</p>
                <p>
                    <small>Ulf Seltmann &lt;seltmann@ub.uni-leipzig.de&gt;<br>
                        Webmaster<br>
                        Projekt finc<br>
                        Universitätsbibliothek Leipzig<br>
                    </small>
                    <img data-src="images/ubl-logo.png" class="frontscreen" height="50"> <img data-src="images/finc-logo.png" class="frontscreen" height="50">
                </p>
            </div>
            <aside class="notes">
                <ul>
                    <li>Guten Tag, mein Name ist Ulf Seltmann und ich möchte Ihnen heute kurz die Containervirtualisierung Docker vorstellen und wie sie uns Entwicklern an der UB Leipzig die tägliche Arbeit an und mit Vufind2 erleichetert</li>
                </ul>
            </aside>
        </section>
        <section data-state="header1" data-background="images/docker/logo-notext.png" data-background-size="300px"
                 data-background-position="680px 30px">
            <small style="position:absolute;top:750px; left:10px">Bildquelle: <i>http://</i></small>
            <section>
                <h3>Über mich</h3>
                <ul>
                    <li>2000 bis 2007 Administrator im Web-/Linux-Umfeld</li>
                    <li>2007 Programmierer für PHP im Bereich e-Commerce</li>
                    <li>seit April 2013 Programmierer in der UB Leipzig,<br> erst im Projekt finc, jetzt als Webmaster
                    </li>
                    </li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>2013 als PHP-Entwickler an die UB Leipzig gekommen</li>
                        <li>obwohl jahrelange Erfahrung als Administrator anfangs große Probleme beim Einrichten einer zufriedenstellenden Entwicklungsumgebung</li>
                        <li>2013/2014 erste Notiz von Docker genommen</li>
                        <li>seitdem verfolge ich die Entwicklung und setze Features im eigenen Image um</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h3>Die Aufgabenstellung</h3>
                <ul>
                    <li>einheitliche Basis für alle Entwickler</li>
                    <li>Aktualisierung an einer Stelle</li>
                    <li>automatischer Installations- und Konfigurationsprozess</li>
                    <li>eigene und Projekt-Tools out-of-the-Box nutzbar</li>
                    <li>individuelle Einschränkung so gering wie möglich</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>ein Setup einzelner VuFind-Komponenten kann eine langwierige Sache werden</li>
                        <li>verschiedene Host-Systeme führten teilweise zu unterschiedlichen Ergebnissen</li>
                        <li>Aktualisierung dieser Systeme musste von jedem Entwickler selbst vorgenommen werden</li>
                        <li>Installation und Konfiguration von Entwicklungswerkzeugen zum debuggen, profilen, unittests, ... blieben meist auf der Strecke</li>
                        <li>Entscheidung fiel auf Docker</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h3>Was ist Docker</h3>
                <ul>
                    <li>Containervirtualisierung für linuxoide Betriebssysteme</li>
                    <li>Resourcen werden per <i>kernel namespaces</i>, <i>cgroups</i>, <i>chroot</i> und <i>selinux</i>
                        vom Host-System isoliert
                    </li>
                    <li>ein Image beinhaltet die notwendigen Abhängigkeiten eines auszuführendes Programmes</li>
                    <li>ein Container ist der isolierte Bereich, in dem das Programm ausgeführt wird</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>virtualisierung eher unpassend</li>
                        <li>es findet keine Emulierung von Hardwarekomponenten statt wie bei herkömmlicher Virtualisierung</li>
                        <li>isolation würde eher zutreffen</li>
                        <li>für Isolation eines Bereichs - Containers - werden Linux-Kernel-Funktionen benutzt</li>
                        <li>sorgen dafür, dass Programme, die im Container ausgeführt werden, nicht auf die Ressourcen des Hostsystems zugreifen</li>
                        <li>Container müssen eigene Werkzeugsammlung mitbringen, um die Bedingungen des auszuführenden Programmes zu erfüllen</li>
                    </ul>

                </aside>
            </section>
        </section>
        <section data-state="header2" data-background="images/docker/docker-image.png" data-background-size="200px"
                 data-background-position="750px 30px">
            <small style="position:absolute;top:750px; left:10px">Bildquelle: <i>http://xebia.github.io/docker-introduction/slides/#/</i>
            </small>
            <section>
                <h3>Docker-Images</h3>
                <ul>
                    <li>leitet ab von Basis-Image</li>
                    <li><code>Dockerfile</code> beschreibt die zusätzliche Installation/Konfiguration</li>
                    <li>Image-Änderungen werden revisioniert</li>
                    <li>Images werden ver-/ge-teilt über öffentliches oder privates Repository</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>vergleichbar mit einem vorinstallierten System, einer Live-CD</li>
                        <li>organisiert in Schichten mittels Overlay-Dateisystem</li>
                        <li>funktioniert ähnlich wie Versionskontrollsysteme</li>
                        <li>in Images wird alles installiert und konfiguriert, soweit es automatisch möglich ist</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h3>Docker-Container</h3>
                <ul>
                    <li>basieren auf einem Image</li>
                    <li>startet mit dem Start eines Programms und beendet mit dessen Beendigung</li>
                    <li>können Volumes des Hostsystems oder anderer Container einbinden</li>
                    <li>können Ports an das Hostsystem oder andere Container forwarden</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li>bilden die Laufzeitumgebung eines Programmes</li>
                        <li>individuelle Konfiguration kann zum Container-Start vorgenommen werden</li>
                        <li>Container selbst sind Wegwerfware und sollten so behandelt werden</li>
                        <li>werden standardmäßig nach dem Beenden nicht gelöscht, kann aber durch eine Option gesetzt werden</li>
                    </ul>
                </aside>
            </section>
            <section>
                <h3>Hello World!</h3>
                <pre class="fragment"><code>#$ docker run --name hello-world ubuntu echo "Hello World!"</code></pre>
                <div class="fragment">
                            <pre><code>Unable to find image 'ubuntu:latest' locally
Pulling repository ubuntu
91e54dfb1179: Download complete
d3a1f33e8a5a: Download complete
c22013c84729: Download complete
d74508fb6632: Download complete
Status: Downloaded newer image for ubuntu:latest
Hello World!
#$
                            </code></pre>
                    <ul>
                        <li><i>run</i>-Kommando legt die Container-Konfiguration fest</li>
                    </ul>
                </div>
            </section>
            <section>
                <h3>Hello World! (Again)</h3>
                <pre class="fragment"><code>#$ docker start -ai hello-world</code></pre>
                <div class="fragment">
                            <pre><code>Hello World!
#$
                            </code></pre>
                    <ul>
                        <li>erneute Container-Starts führen den Container mit der Konfiguration aus, die mit dem
                            <i>run</i>-Kommando festgelegt wurde
                        </li>
                    </ul>
                </div>
            </section>
        </section>
<!--
        <section data-state="header3" data-background="images/docker/docker-getcloudify.org.png"
                 data-background-size="200px" data-background-position="750px 30px">
            <section>
                <h3>Docker installieren/aktivieren/starten</h3>
                <pre><code>sudo yum|apt-get install docker(.io)</code></pre>
                <pre><code>sudo systemctl enable docker</code></pre>
                <pre><code>sudo systemctl start docker</code></pre>
            </section>
        </section>
-->
        <section data-state="header3">
            <h3>Das VuFind2-Image</h3>
            <section>
                <p>VuFind-Sourcen klonen
                <pre class="fragment"><code>#$ git clone https://github.com/vufind-org/vufind.git</code></pre>
                <pre class="fragment"><code>Klone nach 'vufind'...
remote: Counting objects: 106741, done.
remote: Compressing objects: 100% (20/20), done.
remote: Total 106741 (delta 6), reused 0 (delta 0), pack-reused 106720
Empfange Objekte: 100% (106741/106741), 388.15 MiB | 3.83 MiB/s, Fertig.
Löse Unterschiede auf: 100% (69166/69166), Fertig.
Prüfe Konnektivität... Fertig.
                                </code></pre>
                </p>
            </section>
            <section>
                <p>VuFind-Container starten
                <pre class="fragment"><code>#$ sudo docker run --rm -t -i \
    -v $(pwd)/vufind:/usr/local/vufind2 \
    -p 80:80 -p 443:443 -p 8080:8080 -p 3306:3306 \
    useltmann/vufind2</code></pre>
                <pre class="fragment"><code>Unable to find image 'useltmann/vufind2:latest' locally
Pulling repository useltmann/vufind2
dbce69cc9264: Download complete
4c8cbfd2973e: Download complete
...
138278fd23d3: Download complete
Status: Downloaded newer image for useltmann/vufind2:latest
Setting up owner/group of dev...
Setting up runtime environment...
Setting up 10-mysqld...
...
                </code></pre>
                </p>
            </section>
            <section>
                <p>Container aufrufen</p>
                <img data-src="images/docker/vufind2.png" width="900"/><br>
                <code>http://localhost/vufind/</code>
            </section>
            <section>
                <p>ausführliche Dokumentation</p>
                <img data-src="images/docker/docker-hub.png" width="900"/>
                <ul>
                    <li>Suche nach <i>vufind2</i></li>
                    <li>erfüllt alle Anforderungen von VuFind2</li>
                    <li>als Entwicklungstestumgebung (DTE) konzipiert</li>
                </ul>
                <aside class="notes">
                    <ul>
                        <li></li>
                        <li>Benutzung ist hier dokumentiert</li>
                        <li>Einsatz im produktiven Bereich nicht empfohlen, da sensitive Daten über die Laufzeitumgebung preisgegeben werden</li>
                        <li></li>
                    </ul>
                </aside>
            </section>
        </section>
        <section data-state="header4">
            <h3>Die Image-Tools</h3>
            <section>
                <p>PHP-Einstellungen mit <i>PHPInfo</i></p>
                <img data-src="images/docker/phpinfo.png" width="900"/><br>
                <code>http://localhost/phpinfo/</code>
            </section>
            <section>
                <p>Debugging mit <i>XDebug</i></p>
                <img data-src="images/docker/xdebug.png" width="750"/>
                <img data-src="images/docker/xdebug-helper-debug.png" width="150"/>
            </section>
            <section>
                <p>Profiling mit <i>XDebug</i> und <i>webgrind</i></p>
                <img data-src="images/docker/webgrind.png" width="750"/>
                <img data-src="images/docker/xdebug-helper-profile.png" width="150"/><br>
                <code>http://localhost/webgrind/</code>
            </section>
            <section>
                <p>OPCode- und Variable Cache mit <i>XCache</i></p>
                <img data-src="images/docker/xcache.png" width="750"/><br>
                <code>http://localhost/xcache/</code>
            </section>
            <section>
                <p>CI Test mit <i>PHPUnit</i> und <i>CodeSniffer</i></p>
                <pre><code>sudo docker run --rm -t -i -v $(pwd)/vufind:/usr/local/vufind2 \
        useltmann/vufind2 ci</code></pre>
                <pre><code>PHPUnit 4.8.9 by Sebastian Bergmann and contributors.
....
Time: 9.07 seconds, Memory: 95.00Mb

OK, but incomplete, skipped, or risky tests!
Tests: 801, Assertions: 2137, Skipped: 36.
Buildfile: /usr/local/vufind2/build.xml

vufind2 > php-cs-fixer-dryrun:
...
Fixed all files in 130.037 seconds, 18.000 MB memory used

BUILD FINISHED

Total time: 2 minutes  10.28 seconds</code></pre>
            </section>

        </section>
        <section>
            <section>
                <h3>Build-Sourcen auf GitHub</h3>
                <img data-src="images/docker/github.png" width="900"/><br>
                <code>https://github.com/finc/docker-vufind2/</code>

            </section>
            <section>
                <h3>Image auf Docker Hub</h3>
                <img data-src="images/docker/vufind2-image.png" width="900"/><br>
                <code>https://hub.docker.com/r/useltmann/vufind2/</code>
            </section>
        </section>
        <section>
            <div>
            <div class="row">
                <img data-src="images/docker/docker-all-the-things.png"/>
            </div>
            <div class="row">
                <h3>Vielen Dank</h3>
                <p>
                    <small>Ulf Seltmann &lt;seltmann@ub.uni-leipzig.de&gt;<br>
                        Webmaster<br>
                        Projekt finc<br>
                        Universitätsbibliothek Leipzig<br>
                    </small>
                    <img data-src="images/ubl-logo.png" class="frontscreen" height="50">
                    <img data-src="images/finc-logo.png" class="frontscreen" height="50">
                    <img data-src="images/vufind2-logo.png" class="frontscreen" height="50">
                </p>
                <small>
                <ul>
                    <li>https://hub.docker.com/r/useltmann/vufind2/</li>
                    <li>https://github.com/finc/docker-vufind2/</li>
                    <li>https://finc.info/de/</li>
                    <li>https://ub.uni-leipzig.de/</li>
                </ul>
                </small>
            </div>
            </div>
            <aside class="notes">
                <ul>
                    <li>nichts ist fehlerfrei</li>
                    <li>Probleme werden behoben</li>
                    <li>Features werden hinzugefügt</li>
                    <li>Pull requests are welcome</li>
                </ul>
            </aside>
        </section>
    </div>
</div>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.min.js"></script>

<script>

    // Full list of configuration options available here:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        margin: 0.1,
        minScale: 0.2,
        maxScale: 0.8,
        width: 1024,
        height: 768,
        //        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
        transition: 'fade', // default/cube/page/concave/zoom/linear/fade/none

        // Parallax scrolling
        // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
        // parallaxBackgroundSize: '2100px 900px',

        // Optional libraries used to extend on reveal.js
        dependencies: [
            {
                src: 'lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: 'plugin/markdown/marked.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/markdown/markdown.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {
                src: 'plugin/zoom-js/zoom.js', async: true, condition: function () {
                return !!document.body.classList;
            }
            },
            {
                src: 'plugin/notes/notes.js', async: true, condition: function () {
                return !!document.body.classList;
            }
            }
        ]
    });

</script>

</body>
</html>
